mutate(industry=factor(industry, levels=sic_var_levels$industry)) |>
ggplot(aes(y=Value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
# geom_violin() +
geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(industry=factor(industry, levels=sic_var_levels$industry)) |>
ggplot(aes(y=Value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(industry=factor(industry, levels=sic_var_levels$industry)) |>
ggplot(aes(y=Value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin() +
geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(industry=factor(industry, levels=sic_var_levels$industry)) |>
ggplot(aes(y=Value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(trim = FALSE) +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(industry=factor(industry, levels=sic_var_levels$industry)) |>
ggplot(aes(y=Value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(trim = FALSE, adjust = .5) +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(industry=factor(industry, levels=sic_var_levels$industry)) |>
ggplot(aes(y=Value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(draw_quantiles = c(0.25, 0.5, 0.75)) +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(industry=factor(industry, levels=sic_var_levels$industry)) |>
ggplot(aes(y=Value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(draw_quantiles = c(0.25, 0.5, 0.75), trim = FALSE) +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(industry=factor(industry, levels=sic_var_levels$industry)) |>
ggplot(aes(y=Value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(draw_quantiles = c(0.25, 0.5, 0.75), trim = FALSE) +
scale_y_log10() +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(industry=factor(industry, levels=sic_var_levels$industry)) |>
ggplot(aes(y=Value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(draw_quantiles = c(0.25, 0.5, 0.75), trim = FALSE) +
coord_trans(y = "log10") +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
summarize(df$Exposure)
summary(df$Exposure)
summary(df$Value)
hist(df$Value)
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(draw_quantiles = c(0.25, 0.5, 0.75), trim = FALSE) +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(trim = FALSE) +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
# geom_violin(trim = FALSE) +
# geom_jitter() +
geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=Value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
# geom_violin(trim = FALSE) +
# geom_jitter() +
geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
# geom_violin(trim = FALSE) +
# geom_jitter() +
geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# calculate number of firms per industry
sic_n_firms <- df |>
group_by(industry) |>
# get variance for each industry
count(n_firms = n_distinct())
df
# calculate number of firms per industry
sic_n_firms <- df |>
group_by(industry) |>
# get variance for each industry
count(n_firms = n_distinct(isin))
sic_n_firms
# calculate number of firms per industry
sic_n_firms <- df |>
group_by(industry) |>
# get variance for each industry
count()
sic_n_firms
# calculate number of firms per industry
sic_n_firms <- df |>
group_by(industry) |>
count()
# calculate number of firms per industry
sic_n_firms <- df |>
group_by(industry) |>
count() |>
filter(n>50)
sic_n_firms
# Calculate variance within each industry
sic_var <- df |>
filter(sic %in% sic_ct$sic) |>
# group by industry
group_by(industry, Exposure) |>
# get variance for each industry
summarise(Variance = var(Value, na.rm = TRUE)) |>
ungroup() |>
filter(!is.na(industry)) |>
arrange(desc(Variance))
df
# Calculate variance within each industry
sic_var <- df |>
filter(sic %in% sic_n_firms$sic) |>
# group by industry
group_by(industry, Exposure) |>
# get variance for each industry
summarise(Variance = var(Value, na.rm = TRUE)) |>
ungroup() |>
filter(!is.na(industry)) |>
arrange(desc(Variance))
df |>
filter(sic %in% sic_n_firms$sic)
df
sic_n_firms
# calculate number of firms per industry
sic_n_firms <- df |>
group_by(sic) |>
count() |>
filter(n>50)
sic_n_firms
# Calculate variance within each industry
sic_var <- df |>
filter(sic %in% sic_n_firms$sic) |>
# group by industry
group_by(industry, Exposure) |>
# get variance for each industry
summarise(Variance = var(Value, na.rm = TRUE)) |>
ungroup() |>
filter(!is.na(industry)) |>
arrange(desc(Variance))
sic_var
# Calculate mean variance across exposure variables
sic_var_levels <- sic_var |>
group_by(industry) |>
summarise(mean = mean(Variance, na.rm = TRUE)) |>
ungroup() |>
filter(!is.na(industry)) |>
arrange((mean)) |>
tail(15)
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
# geom_violin(trim = FALSE) +
# geom_jitter() +
geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(trim = FALSE) +
# geom_jitter() +
geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(trim = FALSE) +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
?gsub
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(trim = FALSE) +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
ggsave("../results/Figures/descriptives/within_industry_variances_TOP15_violin.pdf", width=10, height=5.5)
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(trim = FALSE, fill = "grey") +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(trim = FALSE, fill = "darkgrey") +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(trim = FALSE, fill = "darkgrey") +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Variance",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
ggsave("../results/Figures/descriptives/within_industry_variances_TOP15_violin.pdf", width=10, height=5.5)
# Plot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
geom_violin(trim = FALSE, fill = "darkgrey") +
# geom_jitter() +
# geom_boxplot(fill="darkgreen", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Distribution of Logged Exposure Variables",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# BoxPlot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
# geom_violin(trim = FALSE, fill = "darkgrey") +
# geom_jitter() +
geom_boxplot(fill="darkgrey", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Distribution of Logged Exposure Variables",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
# BoxPlot
df |>
filter(industry %in% sic_var_levels$industry) |>
mutate(
industry=factor(industry, levels=sic_var_levels$industry),
log_value = log(Value+0.1)
) |>
ggplot(aes(y=log_value,x=industry)) +
facet_wrap(vars(Exposure), nrow=1, scales = "free_x") +
# geom_violin(trim = FALSE, fill = "darkgrey") +
# geom_jitter() +
geom_boxplot(fill="darkgrey", outlier.alpha = .075) +
coord_flip() +
# viridis::scale_color_viridis(discrete = T,end = .9) +
# scale_shape_manual(values=c(15:18)) +
theme_bw() +
labs(y="Distribution of Logged Exposure Variables",x = "") +
theme(legend.position = "bottom",
axis.text.x=element_text(angle = 35, vjust=0.95,hjust=1))
ggsave("../results/Figures/descriptives/within_industry_variances_TOP15_boxplot.pdf", width=10, height=5.5)
